<!DOCTYPE html>
<html>
<head>
	<title>Accordion Component</title>
	<link rel="stylesheet" type="text/css" href="../../src/debug.css">
</head>
<body>
	<element name="accordion" extends="div">
		<template>
			<content></content>
		</template>
		<script>
			if (this !== window) {
				this.lifecycle({
					created: function(root) {
						this._root = root;
						var selectedSection = this._selectedSection = this.querySelector('section');

						// This setTimeout is to give the child sections time to upgrade to accordion-sections. The spec describes an 'upgrade' DOM event that should fire, but it doesn't, so this is a hack for the time being.
						setTimeout(function() {
							selectedSection.selected = true;
						}, 10);

						// Attach listeners
						this.addEventListener('click', function(event) {
							var clickedSection = event.target.parentElement;
							if (clickedSection.selected === false) {
								selectedSection.selected = false;
								clickedSection.selected = true;
								selectedSection = clickedSection;
							}
						});
					}
				});
			}
		</script>
	</element>
	<element name="accordion-section" extends="section">
		<template>
			<style>
				header {
					cursor: pointer;
				}
				div {
					display: none;
				}
				div.selected {
					display: block;
				}
			</style>
			<header>
				<content select="h2:first-of-type"></content>
			</header>
			<div>
				<content></content>
			</div>
		</template>
		<script>
			if (this !== window) {
				this.lifecycle({
					created: function(root) {
						// Define instance properties
						this._root = root;
						this._content = root.querySelector('div');
						Object.defineProperties(this, {
							_selected: {
								value: false,
								writable: true
							}
						});
					}
				});

				this.generatedConstructor.prototype = {
					get selected() {
						return this._selected;
					},
					set selected(selected) {
						if (this._selected !== selected) {
							if (selected === true) {
								this.classList.add('selected');
								this._content.classList.add('selected');
							}
							else {
								this.classList.remove('selected');
								this._content.classList.remove('selected');
							}

							this._selected = selected;
						}
					}
				};
			}
		</script>
	</element>
</body>
</html>
